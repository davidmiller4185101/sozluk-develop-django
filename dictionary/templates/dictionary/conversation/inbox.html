{% extends "dictionary/base.html" %}
{% block bodyattr %}class="default topic-entry-view"{% endblock %}
{% block content %}
    {% load humanize %}
    <h4>mesajlar {% if unread_messages_count %}(<span>{{ unread_messages_count }} okunmamış</span>){% endif %}</h4>
    <hr>

    {% if conversations %}


        <ul class="threads">
            {% for chat in conversations %}
                <li {% if chat.last_message.recipient == request.user and not chat.last_message.read_at %}class="unread"{% endif %}>
                    {% with sender=chat.last_message.sender recipient=chat.last_message.recipient %}
                        {% if sender == request.user %}
                            <a href="{% url 'conversation' username=recipient.username %}">
                            <h5>{{ recipient.username }}</h5>

                        {% else %}
                            <a href="{% url 'conversation' username=sender.username %}">
                            <h5>{{ sender.username }}</h5>
                        {% endif %}
                    {% endwith %}
                    <p>{{ chat.last_message.body }}</p>
                    {{ chat.last_message.sent_at|naturaltime }}
                    </a>
                </li>

            {% endfor %}
        </ul>


        {% include "dictionary/includes/paginaton.html" with paginator=page_obj %}
    {% else %}
        <small>yok ki</small>
    {% endif %}

{% endblock %}
