{% extends "dictionary/base.html" %}
{% block title %}mesajlar{% endblock %}
{% block content %}
    {% load humanize %}
    <h1 class="h4"><strong><a href="{% url 'messages' %}">mesajlar</a></strong> {% if unread_messages_count %}(<span>{{ unread_messages_count }} okunmamış</span>){% endif %}
        {% if request.GET.search_term.strip %}[arama terimi: <strong>{{ request.GET.search_term.strip }}</strong>]{% endif %}</h1>
    <hr>

    {% if conversations %}

        <ul class="threads">
            {% for chat in conversations %}
                {% with lastmsg=chat.last_message %}
                <li {% if lastmsg.recipient == user and not lastmsg.read_at %}class="unread"{% endif %}>
                    <a href="{{ chat.get_absolute_url }}">
                        <h2 class="h5">{{ chat.target.username }}</h2>
                        {% if lastmsg %}
                            <p>{{ lastmsg.body }}</p>
                            <time>{{ lastmsg.sent_at|naturaltime }}</time>
                        {% else %}
                            <p><em>mesaj yok</em></p>
                        {% endif %}
                    </a>
                </li>
                {% endwith %}
            {% endfor %}
        </ul>

        {% include "dictionary/includes/paginaton.html" with paginator=page_obj %}
    {% else %}
        <small>yok ki</small>
    {% endif %}

{% endblock %}

{% block rightframe %}

    <form action="{% url 'messages' %}" method="get">
        <label for="messages_search_term"><h2 class="h5"><strong>mesajlarda ara</strong></h2></label>
        <div class="input-group">
            <input name="search_term" id="messages_search_term" type="text" class="form-control"
                   placeholder="arama terimi" value="{{ request.GET.search_term }}" required>
            <div class="input-group-append">
                <button class="btn btn-django-link" type="submit">ara</button>
            </div>
        </div>
    </form>

    <hr>

    {% load widget_tweaks %}

    <form method="post">
        <h2 class="h5"><strong>yeni mesaj</strong></h2>

        <div class="form-group">
            <label for="recipient_name" class="col-form-label">{{ form.recipient.label }}:</label>
            {% render_field form.recipient class="form-control author-search" id="recipient_name" %}
        </div>

        <div class="form-group">
            <label for="message-body">{{ form.body.label }}:</label>
            {% render_field form.body rows="5" class="form-control" id="message-body" %}
        </div>

        {% csrf_token %}
        <button type="submit" class="btn btn-django">yolla</button>
    </form>

{% endblock %}
