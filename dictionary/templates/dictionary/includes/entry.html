{% load filters %}
{% load functions %}

<li class="entry-full">
    {% if show_title == "yes" %}
        <h5><a href="{{ entry.topic.get_absolute_url }}">{{ entry.topic.title }}</a></h5>
    {% endif %}

    <article class="entry{% if entry.author.is_novice %} by_novice{% endif %}{% if permalink == "yes" %} permalink{% endif %}">
        <p>{{ entry.content|formatted|linebreaksbr }}</p>
    </article>

    <div class="entry_info">

        <span class="left">
           <div class="social">
               <a title="facebook" class="facebook"
                  href="https://www.facebook.com/sharer/sharer.php?u={% entry_full_url req=request entry_id=entry.id %}"
                  target="_blank">
                           <svg width="20" height="16" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                 <path d="M17,2V2H17V6H15C14.31,6 14,6.81 14,7.5V10H14L17,10V14H14V22H10V14H7V10H10V6A4,4 0 0,1 14,2H17Z"/>
                           </svg></a>
               <a title="twitter" class="twitter"
                  href="https://twitter.com/intent/tweet?text={{ entry.topic.title }}: {% entry_full_url req=request entry_id=entry.id %}"
                  target="_blank">
                            <svg height="16" viewBox="0 0 24 24" width="20" xmlns="http://www.w3.org/2000/svg">
                                <path d="M22.46,6C21.69,6.35 20.86,6.58 20,6.69C20.88,6.16 21.56,5.32 21.88,4.31C21.05,4.81 20.13,5.16 19.16,5.36C18.37,4.5 17.26,4 16,4C13.65,4 11.73,5.92 11.73,8.29C11.73,8.63 11.77,8.96 11.84,9.27C8.28,9.09 5.11,7.38 3,4.79C2.63,5.42 2.42,6.16 2.42,6.94C2.42,8.43 3.17,9.75 4.33,10.5C3.62,10.5 2.96,10.3 2.38,10C2.38,10 2.38,10 2.38,10.03C2.38,12.11 3.86,13.85 5.82,14.24C5.46,14.34 5.08,14.39 4.69,14.39C4.42,14.39 4.15,14.36 3.89,14.31C4.43,16 6,17.26 7.89,17.29C6.43,18.45 4.58,19.13 2.56,19.13C2.22,19.13 1.88,19.11 1.54,19.07C3.44,20.29 5.7,21 8.12,21C16,21 20.33,14.46 20.33,8.79C20.33,8.6 20.33,8.42 20.32,8.23C21.16,7.63 21.88,6.87 22.46,6Z"/>
                            </svg></a>
            </div>

           <div class="rate" id="rate" data-entry-id="{{ entry.id }}">
           {% if request.user.is_authenticated and entry.author == request.user %}
           {% else %}
               <a role="button" tabindex="0"
                  class="upvote {% if request.user in entry.upvoted_by.all %}active{% endif %}"
                  id="upvote" title="şükela"><i class="material-icons">keyboard_arrow_up</i>
               </a>
               <a role="button" tabindex="0"
                  class="downvote {% if request.user in entry.downvoted_by.all %}active{% endif %}"
                  id="downvote" title="çok kötü"><i class="material-icons">keyboard_arrow_down</i></a>
           {% endif %}

               {% if request.user.is_authenticated %}

                   {% with favorites=entry.favorited_by.all %}
                       <div class="favorites ml-2" data-entry-id="{{ entry.id }}">

                   <i role="button" tabindex="0"
                      {% if request.user in favorites %}class="material-icons favorite-entry-btn mr-1"
                      title="favorilerden çıkar"
                      {% else %}class="material-icons favorite-entry-btn fav-inverted mr-1"
                      title="favorilere ekle" {% endif %}></i>

                   <a class="dropdown-fav-count {% if not favorites %}dj-hidden{% endif %}"
                      data-toggle="dropdown"
                      role="button" aria-haspopup="true"
                      aria-expanded="false">
                       {% if favorites %}{{ favorites|length }}{% endif %}</a>
                   <span class="dropdown-menu favorites-list" aria-labelledby="dropdownFavorites"></span>
               </div>
                   {% endwith %}

               {% endif %}


                   </div>

        </span>


        <div class="info">
            {# @formatter:off #}
            <a href="{{ entry.get_absolute_url }}">{{ entry.date_created|date:"d.m.Y H:i" }}{% if entry.date_edited %}{% if entry.date_created|date:"dmY" == entry.date_edited|date:"dmY" %}{{ entry.date_edited|date:" ~ H:i" }}{% else %}{{ entry.date_edited|date:" ~ d.m.Y H:i" }}{% endif %}{% endif %}</a>
            {# @formatter:on#}

            {% if not entry.author.is_private %}
                <a class="nick" href="{{ entry.author.get_absolute_url }}">{{ entry.author.username }}</a>
            {% endif %}

            <a role="button" tabindex="0" data-toggle="dropdown" class="pop-menu" aria-haspopup="true">
                <i class="material-icons">more_horiz</i>
                <div class="dropdown-menu dropdown-menu-right"
                     aria-labelledby="entry_dropdown">

                    {% if request.user.is_authenticated and not entry.author.is_private %}

                        {% if request.user != entry.author %}
                            <a role="button" tabindex="0" class="dropdown-item send-message-trigger"
                               data-recipient="{{ entry.author.username }}">mesaj gönder</a>
                            <a role="button" tabindex="0" class="dropdown-item block-user-trigger"
                               data-username="{{ entry.author.username }}">engelle</a>
                        {% else %}

                            <a role="button" tabindex="0" data-target-entry="{{ entry.id }}"
                               class="dropdown-item pin-entry">profilime
                                sabitle{% if request.user.pinned_entry == entry %}me{% endif %}
                            </a>

                            <a role="button" tabindex="0" data-target-entry="{{ entry.id }}"
                               class="dropdown-item delete-entry{% if permalink == "yes" %}-redirect{% endif %}">sil</a>
                            <a href="{% url "entry_update" pk=entry.id %}" class="dropdown-item">düzelt</a>
                        {% endif %}

                    {% endif %}

                    <a class="dropdown-item"
                       href="{% url 'general-report' %}?referrer_entry={{ entry.id }}&referrer_topic={{ entry.topic.title }}">şikayet</a>
                </div>
            </a>

        </div>
    </div>
</li>
