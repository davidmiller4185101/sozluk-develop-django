{% extends "dictionary/base.html" %}

{% block title %}kullanıcı: {{ profile.username }}{% if tab.name != "latest" %} - {{ tab.label }}{% endif %}{% endblock %}
{% block bodyattr %}class="default topic-entry-view has-entries"{% endblock %}

{% block content %}
    {% load humanize %}
    <section class="user-info">
        <h1 class="h4">
            <a href="{% url 'topic-search' %}?q={{ profile.username }}">{{ profile.username }}</a>
            {% with gen=profile.generation %}
                {% if gen %}
                    <small class="ml-2" style="font-size: .5em; vertical-align: middle">{{ gen|ordinal }} nesil {{ profile.is_novice|yesno:"çaylak,yazar" }}</small>
                {% endif %}
            {% endwith %}
        </h1>

        {% if user.is_authenticated and user != profile %}
            {% include "dictionary/includes/send_message_modal.html" %}
            {% include "dictionary/includes/block_user_modal.html" %}

            <ul class="user-links" data-username="{{ profile.username }}">
                <li class="follow-user-trigger">
                    <a role="button" tabindex="0">{% if profile in user.following.all %}takip etme{% else %}takip et{% endif %}</a>
                </li>

                <li class="block-user">
                    <a role="button" tabindex="0">engelle</a>
                </li>

                <li class="send-message">
                    <a role="button" tabindex="0">mesaj gönder</a>
                </li>
            </ul>
        {% endif %}

        {% if profile.is_suspended and user == profile %}
            <div class="alert alert-secondary" role="alert">
                Hesabınız {{ profile.suspended_until }} tarihine kadar askıya alınmıştır. Ayrıntılı bilgi için size
                gönderilen özel mesajı kontrol edin. Eğer bir yanlışlık olduğunu düşünüyorsanız
                <a href="{% url 'general-report' %}">iletişim formunu</a> kullanarak bizimle iletişime geçin.
            </div>
        {% endif %}

        <ul class="user-stats mb-2">
            <li title="toplam entry sayısı">{{ profile.entry_count }}</li>
            <li title="son 1 ayda girdiği entry sayısı">{{ profile.entry_count_month }}</li>
            <li title="son 1 haftada girdiği entry sayısı">{{ profile.entry_count_week }}</li>
            <li title="son 24 saatte girdiği entry sayısı">{{ profile.entry_count_day }}</li>
            <li class="nobullet" title="son entry girdiği zaman">{{ profile.last_entry_date|naturaltime|default:"hiç" }}</li>

            {% if novice_queue %}
                <li class="float-right nobullet">çaylak onay listesinde {{ novice_queue|ordinal }} sıradasınız</li>
            {% endif %}

            <li class="profile-badges nobullet d-block mt-2">
                {% if profile.is_novice %}
                    <a class="badge-item" href="{% url 'topic-unicode-url' unicode_string="çaylak" %}">çaylak</a>
                {% endif %}

                {% if profile.is_suspended %}
                    <a class="badge-item" href="{% url 'topic-unicode-url' unicode_string="lanetli" %}" title="{{ profile.suspended_until|naturaltime }} boyunca">lanetli</a>
                {% endif %}

                {% for badge in profile.badges.all %}
                    <a title="{{ badge.description }}" class="badge-item" {% if badge.url %} href="{{ badge.url }}" target="_blank" {% else %}href="{% url 'topic-unicode-url' unicode_string=badge.name %}"{% endif %}>{{ badge.name }}</a>
                {% endfor %}

                {% if profile.karma_flair %}
                    <span>{{ profile.karma_flair }}</span>
                {% endif %}
            </li>
        </ul>


        {% if profile.pinned_entry %}
            {% with profile.pinned_entry as entry %}
                {% include "dictionary/includes/profile_entry_pinned.html" %}
            {% endwith %}
        {% else %}
            {% if profile.entry_nice %}
                {% with profile.entry_nice as entry %}
                    {% include "dictionary/includes/profile_entry_pinned.html" %}
                {% endwith %}
            {% endif %}
        {% endif %}

    </section>

    {% with object_count=page_obj.paginator.count %}

            <nav class="user-stats-nav">
                <ul>
                    <li {% if tab.name == "latest" %}class="active"{% endif %}><a href="{{ profile.get_absolute_url }}">entry'ler</a></li>
                    <li {% if tab.name == "favorites" %}class="active"{% endif %}><a href="{% url 'user-profile-stats' profile.slug "favorites" %}">favorileri</a></li>

                    <li class="profile-stat-expand{% if tab.name != "latest" and tab.name != "favorites" %} active{% endif %}">
                        <a class="expand" role="button" tabindex="0" id="more-tabs-dropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">istatistikler</a>

                        <div class="dropdown-menu" aria-labelledby="more-tabs-dropdown">
                            <a class="dropdown-item" href="{% url 'user-profile-stats' profile.slug "popular" %}">en çok favorilenenleri</a>
                            <a class="dropdown-item" href="{% url 'user-profile-stats' profile.slug "recentlyvoted" %}">son oylananları</a>
                            <a class="dropdown-item" href="{% url 'user-profile-stats' profile.slug "liked" %}">en beğenilenleri</a>
                            <a class="dropdown-item" href="{% url 'user-profile-stats' profile.slug "weeklygoods" %}">bu hafta dikkat çekenleri</a>
                            <a class="dropdown-item" href="{% url 'user-profile-stats' profile.slug "beloved" %}">el emeği göz nuru</a>
                            <a class="dropdown-item" href="{% url 'user-profile-stats' profile.slug "authors" %}">favori yazarları</a>
                            <a class="dropdown-item" href="{% url 'user-profile-stats' profile.slug "wishes" %}">ukteleri</a>
                            <a class="dropdown-item" href="{% url 'user-profile-stats' profile.slug "channels" %}">katkıda bulunduğu kanallar</a>
                        </div>
                    </li>
                </ul>
            </nav>

        <h2 class="h5 mt-3">
            <strong>
            {% if tab.type == "entry" %}
                <a href="{% url 'topic_list' slug='userstats' %}?user={{ profile.username }}&tab={{ tab.name }}" data-lf-slug="userstats" data-tab="{{ tab.name }}" data-lf-extra='{"user":"{{ profile.username }}"}'>{{ tab.label }}{% if object_count %} ({{ object_count }}){% endif %}</a>
            {% else %}
                <span>{{ tab.label }}{% if object_count %} ({{ object_count }}){% endif %}</span>
            {% endif %}
            </strong>
        </h2>

        {% if object_count > 0 %}

            {% if tab.type == "entry" %}
                <section class="user_entries">
                    <ul class="profile">
                        {% for entry in object_list %}
                            {% include "dictionary/includes/entry.html" with show_title="yes" %}
                        {% endfor %}
                    </ul>
                </section>
            {% endif %}

            {% if tab.type == "author" %}
                <ul class="list-group list-group-flush">
                    {% for author in object_list %}
                        <a class="list-group-item list-group-item-action" href="{{ author.get_absolute_url }}">{{ author.username }}</a>
                    {% endfor %}
                </ul>
            {% endif %}

            {% if tab.type == "topic" %}
                <ul class="list-group list-group-flush">
                    {% for topic in object_list %}
                        <a class="list-group-item list-group-item-action" href="{{ topic.get_absolute_url }}">{{ topic.title }}</a>
                    {% endfor %}
                </ul>
            {% endif %}

            {% if tab.type == "category" %}
                <ul class="list-group list-group-flush">
                    {% for category in object_list %}
                        <li class="list-group-item d-flex justify-content-between">
                        <a href="{% url 'topic_list' slug='userstats' %}?user={{ profile.username }}&tab=channels&channel={{ category.name }}" data-lf-slug="userstats" data-tab="channels" data-lf-extra='{"user": "{{ profile.username }}", "channel": "{{ category.name }}"}' title="{{ category.description }}">#{{ category.name }}</a>
                        <span>{{ category.count }}</span>
                      </li>
                    {% endfor %}
                </ul>
            {% endif %}

        {% else %}
            <small>yok ki</small>
        {% endif %}

    {% endwith %}

    {% include "dictionary/includes/paginaton.html" with paginator=page_obj hr="yes" stretch="yes" index="yes" %}
    <br>

{% endblock %}


{% block rightframe %}
    {% if user.is_authenticated %}

        <label for="memento"><h2 class="h5"><strong>notlar</strong></h2></label>

        <form method="post" class="memento">
            {% load widget_tweaks %}
            {% load filters %}

            {% with profile.username|addstr:" hakkındaki düşünceleriniz" as text_placeholder %}
                {% render_field form.body placeholder=text_placeholder name="memento" class="form-control" rows="10" id="memento" %}
            {% endwith %}

            {% csrf_token %}

            <button class="btn btn-django mt-3 stretch-mobile">kaydet</button>
        </form>
    {% endif %}
{% endblock %}